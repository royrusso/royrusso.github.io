
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>SaaS Multi-Tenant MySQL5 - One Schema - Roy's Blog</title>
  <meta name="author" content="Roy Russo">

  
  <meta name="description" content="Over the past 10 years I&rsquo;ve spent working with multi-tenant software architecture, I&rsquo;ve seen a lot of clever ideas and collosal mistakes &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://royrusso.github.io/blog/2011/02/22/saas-multi-tenant-mysql5-one-schema">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Roy's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-20553038-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Roy's Blog</a></h1>
  
    <h2>On Software and Fish.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:royrusso.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/blog/categories">Categories</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">SaaS Multi-Tenant MySQL5 - One Schema</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-02-22T10:16:26-05:00" pubdate data-updated="true">Feb 22<span>nd</span>, 2011</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Over the past 10 years I&rsquo;ve spent working with multi-tenant software architecture, I&rsquo;ve seen a lot of clever ideas and collosal mistakes made in designing systems for fault-tolerance and scalability. I decided it was time to note some of the best/worst practices here regarding the deployment of SaaS multi-tenant MySQL database designs, as food-for-thought to others designing a system from the ground-up.</p>

<p>Inevitably one of the initial crossroads a design team will reach is whether to design a system using one global schema or many schema. To put it simply, you are deciding on whether you want every customer&rsquo;s data in on MySQL schema or you will have one-schema-per-customer within a MySQL instance. This is not a trivial design question, as getting this &ldquo;right&rdquo; in the beginning will cost you less headaches in the end. I&rsquo;ll assume you aren&rsquo;t designing in a vaccuum, and have a good idea of what the business side of your company would like to achieve with the software you&rsquo;re deploying, ie. customer numbers, size of user-base, transactions per month, etc&hellip;</p>

<p>To make this simple, I&rsquo;ve broken down some of the pros and cons of designing a multi-tenant database architecture with MySQL using <strong>one schema</strong>&hellip;</p>

<!-- more -->


<h3>Pros to a One Schema Strategy:</h3>

<ul>
<li><p><strong>Easier to maintain:</strong> It&rsquo;s easier to run update/delete/backup/etc operations on one schema than many.</p></li>
<li><p><strong>Easier to deploy new code and update existing database: </strong>One update script and BAM! you&rsquo;re live with your new code.</p></li>
<li><p><strong>Easier to backup/mirror data: </strong>Setting up a Master-Master and/or Master-Slave configuration is trivial as it&rsquo;s likely a one-to-one relationship.</p></li>
<li><p><strong>Easier on developers: </strong>It&rsquo;s (a little) easier on developers, as they don&rsquo;t have to worry about switching context to a separate DB for every customer. This will vary depending on the programming language used.</p></li>
</ul>


<h3>Cons to a One Schema Strategy:</h3>

<ul>
<li><p><strong>Risk of co-mingling customer data:</strong> This is the most obvious  and dangerous aspect, because it may not be under the control of the DBA  and some bad coding practices can expose customer data to the wrong  person. Again, this is <strong>not</strong> under the control of the DBA.</p></li>
<li><p><strong>Possible performance problems:</strong> All customers in one schema means all customer on one machine means potentially multi-million row tables that you are joining. You&rsquo;ll need a good DBA that can generate a good SQL query plan that your good developers will adhere to. <strong>A one-schema multi-tenant system is less forgiving</strong> than a many-schema system. Table or Row locks may cripple the entire system!</p></li>
<li><p><strong>Possible problems when deleting a customer entirely:</strong> Removing  one customer from one schema, means you will have missing rows within  your tables&hellip; affecting the lazy coder that likes to &ldquo;SELECT &hellip; ORDER  BY PRIMARY_KEY DESC LIMIT 0,1&rdquo;, just to get MAX ID.</p></li>
<li><p><strong>Increased Hardware Costs:</strong> This depends on what kind of app you&rsquo;re building. If your application will store multi-million row tables that are constantly being crunched for reporting/analytics, you will need some decent hardware. The fact remains that one 128GB 4CPU machine will cost you more than two 64GB 4CPU machines. If you&rsquo;re hosting in the cloud, at last look, it&rsquo;s the same scenario: <a href="http://aws.amazon.com/ec2/pricing/">Amazon pricing</a>.</p></li>
</ul>


<p>I won&rsquo;t comment on what companies I&rsquo;ve worked for or consulted that deploy on this schema as I find that to be unethical. I do know however that SalesForce.com deploys on one schema. SFDC likely pushes billions of transactions a day on a one schema database shared among 50,000+ customers. Then again, SFDC also has a platoon of DBA, a squad of IT folks, and a multi-million-dollar Oracle DB server.</p>

<p>One-schema systems are the most convenient to develop-on and maintain, but convenience doesn&rsquo;t come without costs &ndash; monetary and quality-wise. The question I always start-off with is: &ldquo;<em>Will the system be used by millions of customers with millions of active connections and billions of transactions per day?</em>&rdquo;. This may sound like a silly question, but I find it easier to start here, because if the answer is &ldquo;yes&rdquo;, as in the case of a web analytics or email marketing platform, I&rsquo;m likely not looking at a one-schema system. As for my SalesForce.com connections, even the architects I&rsquo;ve spoken to, wish they had implemented a multi-schema system originally. ;&ndash;)</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">royrusso</span></span>

      








  


<time datetime="2011-02-22T10:16:26-05:00" pubdate data-updated="true">Feb 22<span>nd</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/mysql/'>MySQL</a>, <a class='category' href='/blog/categories/saas/'>SaaS</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://royrusso.github.io/blog/2011/02/22/saas-multi-tenant-mysql5-one-schema/" data-via="" data-counturl="http://royrusso.github.io/blog/2011/02/22/saas-multi-tenant-mysql5-one-schema/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2009/09/18/i-build-a-pond/" title="Previous Post: I build a pond">&laquo; I build a pond</a>
      
      
        <a class="basic-alignment right" href="/blog/2011/02/22/cache-control-with-tomcat-jboss/" title="Next Post: Cache Control with Tomcat-JBoss">Cache Control with Tomcat-JBoss &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/03/12/debug-maven-test-goal-with-intellij-idea/">Debug Maven Test Goal With Intellij IDEA</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/15/elastichq-elasticsearch-monitoring-management/">ElasticHQ - ElasticSearch Monitoring & Management</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/07/05/jwatch-a-quartz-monitor/">JWatch - a Quartz Monitor</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/04/19/terracotta-quartz-relational-model/">Terracotta Quartz Relational Model</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/04/02/get-all-jobs-with-terracotta-quartz-2-0/">Get All Jobs With Terracotta Quartz 2.0+</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/royrusso">@royrusso</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'royrusso',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Roy Russo -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
